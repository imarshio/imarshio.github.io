import{_ as o}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as t,o as l,c,d as s,e as n,f as e,b as p}from"./app-BxKY2YuM.js";const r={},i=s("p",null,"前言",-1),k=s("p",null,[n("以下命令中"),s("code",null,"[]"),n("表示可选项，")],-1),u=s("h2",{id:"角色-用户",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#角色-用户"},[s("span",null,"角色/用户")])],-1),d=s("code",null,"rolcanlogin",-1),m={href:"https://www.postgresql.org/docs/15/sql-alterrole.html",target:"_blank",rel:"noopener noreferrer"},v=p(`<h3 id="查看角色" tabindex="-1"><a class="header-anchor" href="#查看角色"><span>查看角色</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> pg_roles<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="属性" tabindex="-1"><a class="header-anchor" href="#属性"><span>属性</span></a></h4>`,3),b={href:"https://www.postgresql.org/docs/13/role-attributes.html",target:"_blank",rel:"noopener noreferrer"},h=p(`<table><thead><tr><th>列name</th><th>含义</th></tr></thead><tbody><tr><td>rolname</td><td>用户名称</td></tr><tr><td>rolsuper</td><td>是否超级用户，使用<code>SUPERUSER</code>来标识这是一个超级用户</td></tr><tr><td>rolinherit</td><td>用户继承</td></tr><tr><td>rolcreaterole</td><td>能否创建用户，使用<code>CREATEROLE</code>来标识这个用户可以创建用户，但是不能用于创建超级用户</td></tr><tr><td>rolcreatedb</td><td>能否创建数据库，使用<code>CREATEDB</code>来标识这个用户可以创建数据库</td></tr><tr><td>rolcanlogin</td><td>能否登录，使用<code>LOGIN</code>来标识这个用户可以登录</td></tr><tr><td>rolreplication</td><td>能否启用流式复制，使用<code>REPLICATION LOGIN</code>来标识这个用户可以启用流失复制</td></tr><tr><td>rolconnlimit</td><td>用户连接数据库限制，使用<code>CREATE ROLE _**name**_ CONNECTION LIMIT &#39;_**integer**_&#39;.</code>来限制一个用户的最大连接数，<code>-1</code>表示不限制</td></tr><tr><td>rolpassword</td><td>用户密码，使用<code>CREATE ROLE _**name**_ PASSWORD &#39;_**string**_&#39;</code>指定用户密码</td></tr><tr><td>rolvaliduntil</td><td></td></tr><tr><td>rolbypassrls</td><td></td></tr><tr><td>rolconfig</td><td>用户配置</td></tr><tr><td>oid</td><td>用户id</td></tr></tbody></table><p>示例</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>rolname                <span class="token operator">|</span> rolsuper <span class="token operator">|</span> rolinherit <span class="token operator">|</span> rolcreaterole <span class="token operator">|</span> rolcreatedb <span class="token operator">|</span> rolcanlogin <span class="token operator">|</span> rolreplication <span class="token operator">|</span> rolconnlimit <span class="token operator">|</span> rolpassword <span class="token operator">|</span> rolvaliduntil <span class="token operator">|</span> rolbypassrls <span class="token operator">|</span> rolconfig <span class="token operator">|</span>  oid                                                                                                                                                                          
---------------------------+----------+------------+---------------+-------------+-------------+----------------+--------------+-------------+---------------+--------------+-----------+-------                                                                                                                                                                        
 pg_signal_backend         <span class="token operator">|</span> f        <span class="token operator">|</span> t          <span class="token operator">|</span> f             <span class="token operator">|</span> f           <span class="token operator">|</span> f           <span class="token operator">|</span> f              <span class="token operator">|</span>           <span class="token parameter variable">-1</span> <span class="token operator">|</span> ********    <span class="token operator">|</span>               <span class="token operator">|</span> f            <span class="token operator">|</span>           <span class="token operator">|</span>  <span class="token number">4200</span>                                                                                                                                                                         
 pg_read_server_files      <span class="token operator">|</span> f        <span class="token operator">|</span> t          <span class="token operator">|</span> f             <span class="token operator">|</span> f           <span class="token operator">|</span> f           <span class="token operator">|</span> f              <span class="token operator">|</span>           <span class="token parameter variable">-1</span> <span class="token operator">|</span> ********    <span class="token operator">|</span>               <span class="token operator">|</span> f            <span class="token operator">|</span>           <span class="token operator">|</span>  <span class="token number">4569</span>                                                                                                                                                                         
 postgres                  <span class="token operator">|</span> t        <span class="token operator">|</span> t          <span class="token operator">|</span> t             <span class="token operator">|</span> t           <span class="token operator">|</span> t           <span class="token operator">|</span> t              <span class="token operator">|</span>           <span class="token parameter variable">-1</span> <span class="token operator">|</span> ********    <span class="token operator">|</span>               <span class="token operator">|</span> t            <span class="token operator">|</span>           <span class="token operator">|</span>    <span class="token number">10</span>                                                                                                                                                                         
 pg_write_server_files     <span class="token operator">|</span> f        <span class="token operator">|</span> t          <span class="token operator">|</span> f             <span class="token operator">|</span> f           <span class="token operator">|</span> f           <span class="token operator">|</span> f              <span class="token operator">|</span>           <span class="token parameter variable">-1</span> <span class="token operator">|</span> ********    <span class="token operator">|</span>               <span class="token operator">|</span> f            <span class="token operator">|</span>           <span class="token operator">|</span>  <span class="token number">4570</span>                                                                                                                                                                         
 pg_execute_server_program <span class="token operator">|</span> f        <span class="token operator">|</span> t          <span class="token operator">|</span> f             <span class="token operator">|</span> f           <span class="token operator">|</span> f           <span class="token operator">|</span> f              <span class="token operator">|</span>           <span class="token parameter variable">-1</span> <span class="token operator">|</span> ********    <span class="token operator">|</span>               <span class="token operator">|</span> f            <span class="token operator">|</span>           <span class="token operator">|</span>  <span class="token number">4571</span>                                                                                                                                                                         
 pg_read_all_stats         <span class="token operator">|</span> f        <span class="token operator">|</span> t          <span class="token operator">|</span> f             <span class="token operator">|</span> f           <span class="token operator">|</span> f           <span class="token operator">|</span> f              <span class="token operator">|</span>           <span class="token parameter variable">-1</span> <span class="token operator">|</span> ********    <span class="token operator">|</span>               <span class="token operator">|</span> f            <span class="token operator">|</span>           <span class="token operator">|</span>  <span class="token number">3375</span>                                                                                                                                                                         
 pg_monitor                <span class="token operator">|</span> f        <span class="token operator">|</span> t          <span class="token operator">|</span> f             <span class="token operator">|</span> f           <span class="token operator">|</span> f           <span class="token operator">|</span> f              <span class="token operator">|</span>           <span class="token parameter variable">-1</span> <span class="token operator">|</span> ********    <span class="token operator">|</span>               <span class="token operator">|</span> f            <span class="token operator">|</span>           <span class="token operator">|</span>  <span class="token number">3373</span>                                                                                                                                                                         
 pg_read_all_settings      <span class="token operator">|</span> f        <span class="token operator">|</span> t          <span class="token operator">|</span> f             <span class="token operator">|</span> f           <span class="token operator">|</span> f           <span class="token operator">|</span> f              <span class="token operator">|</span>           <span class="token parameter variable">-1</span> <span class="token operator">|</span> ********    <span class="token operator">|</span>               <span class="token operator">|</span> f            <span class="token operator">|</span>           <span class="token operator">|</span>  <span class="token number">3374</span>                                                                                                                                                                         
 pg_stat_scan_tables       <span class="token operator">|</span> f        <span class="token operator">|</span> t          <span class="token operator">|</span> f             <span class="token operator">|</span> f           <span class="token operator">|</span> f           <span class="token operator">|</span> f              <span class="token operator">|</span>           <span class="token parameter variable">-1</span> <span class="token operator">|</span> ********    <span class="token operator">|</span>               <span class="token operator">|</span> f            <span class="token operator">|</span>           <span class="token operator">|</span>  <span class="token number">3377</span>                                                                                                                                                                         
 marshio                   <span class="token operator">|</span> f        <span class="token operator">|</span> t          <span class="token operator">|</span> f             <span class="token operator">|</span> f           <span class="token operator">|</span> f           <span class="token operator">|</span> f              <span class="token operator">|</span>           <span class="token parameter variable">-1</span> <span class="token operator">|</span> ********    <span class="token operator">|</span>               <span class="token operator">|</span> f            <span class="token operator">|</span>           <span class="token operator">|</span> <span class="token number">16385</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="创建角色" tabindex="-1"><a class="header-anchor" href="#创建角色"><span>创建角色</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">create</span> role marshio<span class="token punctuation">;</span>

<span class="token comment">-- 出现CREATE ROLE则表示创建成功</span>

<span class="token comment">-- 详情查看</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> pg_roles <span class="token keyword">where</span> rolname <span class="token operator">=</span> <span class="token string">&#39;marshio&#39;</span><span class="token punctuation">;</span>
 rolname <span class="token operator">|</span> rolsuper <span class="token operator">|</span> rolinherit <span class="token operator">|</span> rolcreaterole <span class="token operator">|</span> rolcreatedb <span class="token operator">|</span> rolcanlogin <span class="token operator">|</span> rolreplication <span class="token operator">|</span> rolconnlimit <span class="token operator">|</span> rolpassword <span class="token operator">|</span> rolvaliduntil <span class="token operator">|</span> rolbypassrls <span class="token operator">|</span> rolconfig <span class="token operator">|</span>  oid  
<span class="token comment">---------+----------+------------+---------------+-------------+-------------+----------------+--------------+-------------+---------------+--------------+-----------+-------</span>
 marshio <span class="token operator">|</span> f        <span class="token operator">|</span> t          <span class="token operator">|</span> f             <span class="token operator">|</span> f           <span class="token operator">|</span> f           <span class="token operator">|</span> f              <span class="token operator">|</span>           <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">|</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>    <span class="token operator">|</span>               <span class="token operator">|</span> f            <span class="token operator">|</span>           <span class="token operator">|</span> <span class="token number">16385</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="角色更改" tabindex="-1"><a class="header-anchor" href="#角色更改"><span>角色更改</span></a></h3><h4 id="更改用户名" tabindex="-1"><a class="header-anchor" href="#更改用户名"><span>更改用户名</span></a></h4><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">ALTER</span> ROLE name <span class="token keyword">RENAME</span> <span class="token keyword">TO</span> new_name
<span class="token keyword">ALTER</span> ROLE test <span class="token keyword">rename</span> <span class="token keyword">to</span> test1<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="更改密码" tabindex="-1"><a class="header-anchor" href="#更改密码"><span>更改密码</span></a></h4><p><code>ALTER ROLE rolename WITH PASSWORD &#39;newpassword&#39;;</code></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>ALTER ROLE postgres WITH PASSWORD <span class="token string">&#39;postgres&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="更改权限" tabindex="-1"><a class="header-anchor" href="#更改权限"><span>更改权限</span></a></h4>`,12),w={href:"https://www.postgresql.org/docs/13/sql-alterrole.html",target:"_blank",rel:"noopener noreferrer"},g=s("code",null,"ALTER ROLE role_specification [ WITH ] option [ ... ]",-1),y=p(`<div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">-- 创建测试用户，不可登录</span>
<span class="token keyword">create</span> role test<span class="token punctuation">;</span>

<span class="token comment">-- 设置为可登录用户</span>
<span class="token keyword">alter</span> role test login<span class="token punctuation">;</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="删除角色" tabindex="-1"><a class="header-anchor" href="#删除角色"><span>删除角色</span></a></h3><p><code>DROP ROLE [ IF EXISTS ] name [, ...]</code></p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">drop</span> role test<span class="token punctuation">;</span>

<span class="token comment">-- 样例</span>
postgres<span class="token operator">=</span><span class="token comment"># drop role test1;</span>
<span class="token keyword">DROP</span> ROLE
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查看用户" tabindex="-1"><a class="header-anchor" href="#查看用户"><span>查看用户</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> pg_user<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="创建用户" tabindex="-1"><a class="header-anchor" href="#创建用户"><span>创建用户</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">user</span> marshio<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>需要注意的是，官方对role和user的区分为：</p><blockquote><p>Only roles that have the LOGIN attribute can be used as the initial role name for a database connection. A role with the LOGIN attribute can be considered the same as a “database user”. To create a role with login privilege, use either: 上面英文的意思大致是只有携带LOGIN属性的role才能被用来数据库连接。携带LOGIN属性的role可以被视为一个数据库用户。创建一个可以登陆的role有如下两种方法： <code>CREATE ROLE name LOGIN;</code><code>CREATE USER name;</code> 即 <code>CREATE ROLE name LOGIN;</code> 等价于 <code>CREATE USER name;</code>都是创建一个可以登陆的role。</p></blockquote><p>所以，在postgres中不允许role和user同名。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>-- 用户和role同名测试
<span class="token assign-left variable">postgres</span><span class="token operator">=</span><span class="token comment"># create role marshio;</span>
CREATE ROLE

<span class="token assign-left variable">postgres</span><span class="token operator">=</span><span class="token comment"># create user marshio;                                                                                                                                                                                                                                                                                                                                         </span>
ERROR:  role <span class="token string">&quot;marshio&quot;</span> already exists

-- CREATE ROLE name LOGIN和CREATE <span class="token environment constant">USER</span> name互相验证
<span class="token assign-left variable">postgres</span><span class="token operator">=</span><span class="token comment"># create user lx;</span>
CREATE ROLE
<span class="token assign-left variable">postgres</span><span class="token operator">=</span><span class="token comment"># select * from pg_user;</span>
 usename  <span class="token operator">|</span> usesysid <span class="token operator">|</span> usecreatedb <span class="token operator">|</span> usesuper <span class="token operator">|</span> userepl <span class="token operator">|</span> usebypassrls <span class="token operator">|</span>  <span class="token function">passwd</span>  <span class="token operator">|</span> valuntil <span class="token operator">|</span> useconfig 
----------+----------+-------------+----------+---------+--------------+----------+----------+-----------
 postgres <span class="token operator">|</span>       <span class="token number">10</span> <span class="token operator">|</span> t           <span class="token operator">|</span> t        <span class="token operator">|</span> t       <span class="token operator">|</span> t            <span class="token operator">|</span> ******** <span class="token operator">|</span>          <span class="token operator">|</span> 
 lx       <span class="token operator">|</span>    <span class="token number">16386</span> <span class="token operator">|</span> f           <span class="token operator">|</span> f        <span class="token operator">|</span> f       <span class="token operator">|</span> f            <span class="token operator">|</span> ******** <span class="token operator">|</span>          <span class="token operator">|</span> 
<span class="token punctuation">(</span><span class="token number">2</span> rows<span class="token punctuation">)</span>

<span class="token assign-left variable">postgres</span><span class="token operator">=</span><span class="token comment"># select * from pg_roles where rolname = &#39;lx&#39;;</span>
 rolname <span class="token operator">|</span> rolsuper <span class="token operator">|</span> rolinherit <span class="token operator">|</span> rolcreaterole <span class="token operator">|</span> rolcreatedb <span class="token operator">|</span> rolcanlogin <span class="token operator">|</span> rolreplication <span class="token operator">|</span> rolconnlimit <span class="token operator">|</span> rolpassword <span class="token operator">|</span> rolvaliduntil <span class="token operator">|</span> rolbypassrls <span class="token operator">|</span> rolconfig <span class="token operator">|</span>  oid  
---------+----------+------------+---------------+-------------+-------------+----------------+--------------+-------------+---------------+--------------+-----------+-------
 lx      <span class="token operator">|</span> f        <span class="token operator">|</span> t          <span class="token operator">|</span> f             <span class="token operator">|</span> f           <span class="token operator">|</span> t           <span class="token operator">|</span> f              <span class="token operator">|</span>           <span class="token parameter variable">-1</span> <span class="token operator">|</span> ********    <span class="token operator">|</span>               <span class="token operator">|</span> f            <span class="token operator">|</span>           <span class="token operator">|</span> <span class="token number">16386</span>

<span class="token assign-left variable">postgres</span><span class="token operator">=</span><span class="token comment"># create role zmh LOGIN;</span>
CREATE ROLE

<span class="token assign-left variable">postgres</span><span class="token operator">=</span><span class="token comment"># select * from pg_user;</span>
 usename  <span class="token operator">|</span> usesysid <span class="token operator">|</span> usecreatedb <span class="token operator">|</span> usesuper <span class="token operator">|</span> userepl <span class="token operator">|</span> usebypassrls <span class="token operator">|</span>  <span class="token function">passwd</span>  <span class="token operator">|</span> valuntil <span class="token operator">|</span> useconfig 
----------+----------+-------------+----------+---------+--------------+----------+----------+-----------
 postgres <span class="token operator">|</span>       <span class="token number">10</span> <span class="token operator">|</span> t           <span class="token operator">|</span> t        <span class="token operator">|</span> t       <span class="token operator">|</span> t            <span class="token operator">|</span> ******** <span class="token operator">|</span>          <span class="token operator">|</span> 
 lx       <span class="token operator">|</span>    <span class="token number">16386</span> <span class="token operator">|</span> f           <span class="token operator">|</span> f        <span class="token operator">|</span> f       <span class="token operator">|</span> f            <span class="token operator">|</span> ******** <span class="token operator">|</span>          <span class="token operator">|</span> 
 zmh      <span class="token operator">|</span>    <span class="token number">16387</span> <span class="token operator">|</span> f           <span class="token operator">|</span> f        <span class="token operator">|</span> f       <span class="token operator">|</span> f            <span class="token operator">|</span> ******** <span class="token operator">|</span>          <span class="token operator">|</span> 
<span class="token punctuation">(</span><span class="token number">3</span> rows<span class="token punctuation">)</span>

<span class="token assign-left variable">postgres</span><span class="token operator">=</span><span class="token comment"># select * from pg_roles where rolname = &#39;zmh&#39;;</span>
 rolname <span class="token operator">|</span> rolsuper <span class="token operator">|</span> rolinherit <span class="token operator">|</span> rolcreaterole <span class="token operator">|</span> rolcreatedb <span class="token operator">|</span> rolcanlogin <span class="token operator">|</span> rolreplication <span class="token operator">|</span> rolconnlimit <span class="token operator">|</span> rolpassword <span class="token operator">|</span> rolvaliduntil <span class="token operator">|</span> rolbypassrls <span class="token operator">|</span> rolconfig <span class="token operator">|</span>  oid  
---------+----------+------------+---------------+-------------+-------------+----------------+--------------+-------------+---------------+--------------+-----------+-------
 zmh     <span class="token operator">|</span> f        <span class="token operator">|</span> t          <span class="token operator">|</span> f             <span class="token operator">|</span> f           <span class="token operator">|</span> t           <span class="token operator">|</span> f              <span class="token operator">|</span>           <span class="token parameter variable">-1</span> <span class="token operator">|</span> ********    <span class="token operator">|</span>               <span class="token operator">|</span> f            <span class="token operator">|</span>           <span class="token operator">|</span> <span class="token number">16387</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="用户切换" tabindex="-1"><a class="header-anchor" href="#用户切换"><span>用户切换</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">-- 切换用户</span>
postgres<span class="token operator">=</span><span class="token comment"># \\c - postgres</span>
You are now connected <span class="token keyword">to</span> <span class="token keyword">database</span> <span class="token string">&quot;postgres&quot;</span> <span class="token keyword">as</span> <span class="token keyword">user</span> <span class="token string">&quot;postgres&quot;</span><span class="token punctuation">.</span>



<span class="token comment"># 可能会出现异常</span>
psql: error: FATAL:  Peer authentication failed <span class="token keyword">for</span> <span class="token keyword">user</span> <span class="token string">&quot;marshio&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="database" tabindex="-1"><a class="header-anchor" href="#database"><span>Database</span></a></h2>`,15),E={href:"https://www.postgresql.org/docs/13/catalog-pg-database.html",target:"_blank",rel:"noopener noreferrer"},f=p(`<h3 id="查看db" tabindex="-1"><a class="header-anchor" href="#查看db"><span>查看DB</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> pg_databse<span class="token punctuation">;</span>


postgres<span class="token operator">=</span><span class="token comment"># select * from pg_database;</span>
  oid  <span class="token operator">|</span>  datname  <span class="token operator">|</span> datdba <span class="token operator">|</span> encoding <span class="token operator">|</span> datcollate  <span class="token operator">|</span>  datctype   <span class="token operator">|</span> datistemplate <span class="token operator">|</span> datallowconn <span class="token operator">|</span> datconnlimit <span class="token operator">|</span> datlastsysoid <span class="token operator">|</span> datfrozenxid <span class="token operator">|</span> datminmxid <span class="token operator">|</span> dattablespace <span class="token operator">|</span>               datacl                
<span class="token comment">-------+-----------+--------+----------+-------------+-------------+---------------+--------------+--------------+---------------+--------------+------------+---------------+-------------------------------------</span>
 <span class="token number">14174</span> <span class="token operator">|</span> postgres  <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>        <span class="token number">6</span> <span class="token operator">|</span> en_US<span class="token punctuation">.</span>UTF<span class="token operator">-</span><span class="token number">8</span> <span class="token operator">|</span> en_US<span class="token punctuation">.</span>UTF<span class="token operator">-</span><span class="token number">8</span> <span class="token operator">|</span> f             <span class="token operator">|</span> t            <span class="token operator">|</span>           <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">|</span>         <span class="token number">14173</span> <span class="token operator">|</span>          <span class="token number">479</span> <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span>          <span class="token number">1663</span> <span class="token operator">|</span> 
 <span class="token number">16393</span> <span class="token operator">|</span> db1       <span class="token operator">|</span>  <span class="token number">16385</span> <span class="token operator">|</span>        <span class="token number">6</span> <span class="token operator">|</span> en_US<span class="token punctuation">.</span>UTF<span class="token operator">-</span><span class="token number">8</span> <span class="token operator">|</span> en_US<span class="token punctuation">.</span>UTF<span class="token operator">-</span><span class="token number">8</span> <span class="token operator">|</span> f             <span class="token operator">|</span> t            <span class="token operator">|</span>           <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">|</span>         <span class="token number">14173</span> <span class="token operator">|</span>          <span class="token number">479</span> <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span>          <span class="token number">1663</span> <span class="token operator">|</span> 
     <span class="token number">1</span> <span class="token operator">|</span> template1 <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>        <span class="token number">6</span> <span class="token operator">|</span> en_US<span class="token punctuation">.</span>UTF<span class="token operator">-</span><span class="token number">8</span> <span class="token operator">|</span> en_US<span class="token punctuation">.</span>UTF<span class="token operator">-</span><span class="token number">8</span> <span class="token operator">|</span> t             <span class="token operator">|</span> t            <span class="token operator">|</span>           <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">|</span>         <span class="token number">14173</span> <span class="token operator">|</span>          <span class="token number">479</span> <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span>          <span class="token number">1663</span> <span class="token operator">|</span> {<span class="token operator">=</span>c<span class="token operator">/</span>postgres<span class="token punctuation">,</span>postgres<span class="token operator">=</span>CTc<span class="token operator">/</span>postgres}
 <span class="token number">14173</span> <span class="token operator">|</span> template0 <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>        <span class="token number">6</span> <span class="token operator">|</span> en_US<span class="token punctuation">.</span>UTF<span class="token operator">-</span><span class="token number">8</span> <span class="token operator">|</span> en_US<span class="token punctuation">.</span>UTF<span class="token operator">-</span><span class="token number">8</span> <span class="token operator">|</span> t             <span class="token operator">|</span> f            <span class="token operator">|</span>           <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">|</span>         <span class="token number">14173</span> <span class="token operator">|</span>          <span class="token number">479</span> <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span>          <span class="token number">1663</span> <span class="token operator">|</span> {<span class="token operator">=</span>c<span class="token operator">/</span>postgres<span class="token punctuation">,</span>postgres<span class="token operator">=</span>CTc<span class="token operator">/</span>postgres}
<span class="token punctuation">(</span><span class="token number">4</span> <span class="token keyword">rows</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="创建db" tabindex="-1"><a class="header-anchor" href="#创建db"><span>创建DB</span></a></h3>`,3),T={href:"https://www.postgresql.org/docs/13/sql-createdatabase.html",target:"_blank",rel:"noopener noreferrer"},_=p(`<div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> name
    <span class="token punctuation">[</span> <span class="token keyword">WITH</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> OWNER <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span> user_name <span class="token punctuation">]</span>
           <span class="token punctuation">[</span> TEMPLATE <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span> template <span class="token punctuation">]</span>
           <span class="token punctuation">[</span> ENCODING <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span> encoding <span class="token punctuation">]</span>
           <span class="token punctuation">[</span> LOCALE <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span> locale <span class="token punctuation">]</span>
           <span class="token punctuation">[</span> LC_COLLATE <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span> lc_collate <span class="token punctuation">]</span>
           <span class="token punctuation">[</span> LC_CTYPE <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span> lc_ctype <span class="token punctuation">]</span>
           <span class="token punctuation">[</span> <span class="token keyword">TABLESPACE</span> <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span> tablespace_name <span class="token punctuation">]</span>
           <span class="token punctuation">[</span> ALLOW_CONNECTIONS <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span> allowconn <span class="token punctuation">]</span>
           <span class="token punctuation">[</span> CONNECTION <span class="token keyword">LIMIT</span> <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span> connlimit <span class="token punctuation">]</span>
           <span class="token punctuation">[</span> IS_TEMPLATE <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span> istemplate <span class="token punctuation">]</span>

<span class="token comment">-- 示例</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> db1 owner marshio<span class="token punctuation">;</span>

postgres<span class="token operator">=</span><span class="token comment"># CREATE DATABASE db1 owner marshio;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="切换db" tabindex="-1"><a class="header-anchor" href="#切换db"><span>切换DB</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">-- 切换DB</span>
\\c dbname

<span class="token comment">-- 切换role</span>
\\c <span class="token operator">-</span> rolename

<span class="token comment">-- 带用户user切换DB</span>
\\c dbname rolename
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="schema" tabindex="-1"><a class="header-anchor" href="#schema"><span>Schema</span></a></h2>`,4),A={href:"https://www.postgresql.org/docs/current/ddl-schemas.html",target:"_blank",rel:"noopener noreferrer"},q=p(`<h3 id="创建schema" tabindex="-1"><a class="header-anchor" href="#创建schema"><span>创建schema</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 创建一个schema</span>
create schema myschema<span class="token punctuation">;</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查看schema" tabindex="-1"><a class="header-anchor" href="#查看schema"><span>查看schema</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>
postgres<span class="token operator">=</span><span class="token comment"># \\dn+</span>
                           List <span class="token keyword">of</span> schemas
   Name   <span class="token operator">|</span>  Owner   <span class="token operator">|</span>  Access <span class="token keyword">privileges</span>   <span class="token operator">|</span>      Description       
<span class="token comment">----------+----------+----------------------+------------------------</span>
 myschema <span class="token operator">|</span> postgres <span class="token operator">|</span>                      <span class="token operator">|</span> 
 <span class="token keyword">public</span>   <span class="token operator">|</span> postgres <span class="token operator">|</span> postgres<span class="token operator">=</span>UC<span class="token operator">/</span>postgres<span class="token operator">+</span><span class="token operator">|</span> standard <span class="token keyword">public</span> <span class="token keyword">schema</span>
          <span class="token operator">|</span>          <span class="token operator">|</span> <span class="token operator">=</span>UC<span class="token operator">/</span>postgres         <span class="token operator">|</span> 
<span class="token punctuation">(</span><span class="token number">2</span> <span class="token keyword">rows</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="schema权限" tabindex="-1"><a class="header-anchor" href="#schema权限"><span>schema权限</span></a></h3>`,5),R={href:"https://www.postgresql.org/docs/13/sql-grant.html",target:"_blank",rel:"noopener noreferrer"},O=p(`<div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">-- 给用户roleA添加myschema的使用权限</span>
<span class="token keyword">GRANT</span> <span class="token keyword">USAGE</span> <span class="token keyword">on</span> <span class="token keyword">SCHEMA</span> myschema <span class="token keyword">to</span> rolaA<span class="token punctuation">;</span>

<span class="token comment">-- 给用户roleA添加myschema的所有权限</span>
<span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">ON</span> <span class="token keyword">ALL</span> <span class="token keyword">TABLES</span> <span class="token operator">IN</span> <span class="token keyword">SCHEMA</span> myschema <span class="token keyword">To</span> roleA<span class="token punctuation">;</span>  

<span class="token comment">-- 将用户postgres对的权限,暂定，验证未通过</span>
<span class="token keyword">ALTER</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">PRIVILEGES</span> <span class="token keyword">FOR</span> ROLE postgres <span class="token operator">in</span> <span class="token keyword">SCHEMA</span> myschema <span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> <span class="token keyword">tables</span> <span class="token keyword">TO</span> roleA<span class="token punctuation">;</span>

<span class="token comment">-- </span>
<span class="token keyword">GRANT</span> <span class="token keyword">USAGE</span> <span class="token keyword">ON</span> <span class="token keyword">SCHEMA</span> postgres <span class="token keyword">TO</span> marshio<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>异常记录：</p>`,2),N={id:"permission-denied-for-schema-even-though-grants-were-given",tabindex:"-1"},L={class:"header-anchor",href:"#permission-denied-for-schema-even-though-grants-were-given"},I={href:"https://stackoverflow.com/questions/52830768/postgres-permission-denied-for-schema-even-though-grants-were-given",target:"_blank",rel:"noopener noreferrer"},S=p(`<p>解决</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">-- </span>
<span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">ON</span> <span class="token keyword">ALL</span> <span class="token keyword">TABLES</span> <span class="token operator">IN</span> <span class="token keyword">SCHEMA</span> myschema <span class="token keyword">To</span> roleA<span class="token punctuation">;</span>  

<span class="token keyword">GRANT</span> <span class="token keyword">USAGE</span> <span class="token keyword">ON</span> <span class="token keyword">SCHEMA</span> postgres <span class="token keyword">TO</span> marshio<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="table" tabindex="-1"><a class="header-anchor" href="#table"><span>Table</span></a></h2><h3 id="查看数据库" tabindex="-1"><a class="header-anchor" href="#查看数据库"><span>查看数据库</span></a></h3><h3 id="创建数据库" tabindex="-1"><a class="header-anchor" href="#创建数据库"><span>创建数据库</span></a></h3>`,5),G={href:"https://www.postgresql.org/docs/13/sql-createtable.html",target:"_blank",rel:"noopener noreferrer"},C=p(`<div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> tablename <span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 指定默认值，sequence</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> test<span class="token punctuation">(</span>id <span class="token keyword">int</span> <span class="token keyword">default</span> nextval<span class="token punctuation">(</span><span class="token string">&#39;test_id&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="sequence" tabindex="-1"><a class="header-anchor" href="#sequence"><span>Sequence</span></a></h2>`,2),x={href:"https://www.postgresql.org/docs/13/infoschema-sequences.html",target:"_blank",rel:"noopener noreferrer"},P=s("h3",{id:"创建sequence",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#创建sequence"},[s("span",null,"创建Sequence")])],-1),U={href:"https://www.postgresql.org/docs/13/sql-createsequence.html",target:"_blank",rel:"noopener noreferrer"},D=p(`<div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">-- 创建一个从101开始增长的序列，值最小为1</span>
<span class="token keyword">CREATE</span> SEQUENCE <span class="token keyword">serial</span> <span class="token keyword">START</span> <span class="token number">101</span><span class="token punctuation">;</span>

<span class="token comment">-- sequence 从0开始会报错</span>
marshio<span class="token operator">=</span><span class="token comment"># create sequence test_id start 0;</span>
ERROR:  <span class="token keyword">START</span> <span class="token keyword">value</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> cannot be less than MINVALUE <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
marshio<span class="token operator">=</span><span class="token comment"># create sequence test_id start 1;</span>
<span class="token keyword">CREATE</span> SEQUENCE

<span class="token comment">-- 使用</span>
<span class="token keyword">SELECT</span> nextval<span class="token punctuation">(</span><span class="token string">&#39;serial&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="sequence权限" tabindex="-1"><a class="header-anchor" href="#sequence权限"><span>Sequence权限</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">-- 将所有的sequence给schema_name下的role授权</span>
<span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">ON</span> <span class="token keyword">ALL</span> SEQUENCES <span class="token operator">IN</span> <span class="token keyword">SCHEMA</span> schema_name <span class="token keyword">TO</span> role<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="grant" tabindex="-1"><a class="header-anchor" href="#grant"><span>Grant</span></a></h2>`,4),B={href:"https://www.postgresql.org/docs/13/sql-grant.html",target:"_blank",rel:"noopener noreferrer"},H=p(`<div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">GRANT</span> { { <span class="token keyword">SELECT</span> <span class="token operator">|</span> <span class="token keyword">INSERT</span> <span class="token operator">|</span> <span class="token keyword">UPDATE</span> <span class="token operator">|</span> <span class="token keyword">DELETE</span> <span class="token operator">|</span> <span class="token keyword">TRUNCATE</span> <span class="token operator">|</span> <span class="token keyword">REFERENCES</span> <span class="token operator">|</span> <span class="token keyword">TRIGGER</span> }
    <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token keyword">ALL</span> <span class="token punctuation">[</span> <span class="token keyword">PRIVILEGES</span> <span class="token punctuation">]</span> }
    <span class="token keyword">ON</span> { <span class="token punctuation">[</span> <span class="token keyword">TABLE</span> <span class="token punctuation">]</span> table_name <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
         <span class="token operator">|</span> <span class="token keyword">ALL</span> <span class="token keyword">TABLES</span> <span class="token operator">IN</span> <span class="token keyword">SCHEMA</span> schema_name <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> }
    <span class="token keyword">TO</span> role_specification <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token keyword">WITH</span> <span class="token keyword">GRANT</span> <span class="token keyword">OPTION</span> <span class="token punctuation">]</span>

<span class="token keyword">GRANT</span> { { <span class="token keyword">SELECT</span> <span class="token operator">|</span> <span class="token keyword">INSERT</span> <span class="token operator">|</span> <span class="token keyword">UPDATE</span> <span class="token operator">|</span> <span class="token keyword">REFERENCES</span> } <span class="token punctuation">(</span> column_name <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
    <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token keyword">ALL</span> <span class="token punctuation">[</span> <span class="token keyword">PRIVILEGES</span> <span class="token punctuation">]</span> <span class="token punctuation">(</span> column_name <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> }
    <span class="token keyword">ON</span> <span class="token punctuation">[</span> <span class="token keyword">TABLE</span> <span class="token punctuation">]</span> table_name <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
    <span class="token keyword">TO</span> role_specification <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token keyword">WITH</span> <span class="token keyword">GRANT</span> <span class="token keyword">OPTION</span> <span class="token punctuation">]</span>

<span class="token keyword">GRANT</span> { { <span class="token keyword">USAGE</span> <span class="token operator">|</span> <span class="token keyword">SELECT</span> <span class="token operator">|</span> <span class="token keyword">UPDATE</span> }
    <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token keyword">ALL</span> <span class="token punctuation">[</span> <span class="token keyword">PRIVILEGES</span> <span class="token punctuation">]</span> }
    <span class="token keyword">ON</span> { SEQUENCE sequence_name <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
         <span class="token operator">|</span> <span class="token keyword">ALL</span> SEQUENCES <span class="token operator">IN</span> <span class="token keyword">SCHEMA</span> schema_name <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> }
    <span class="token keyword">TO</span> role_specification <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token keyword">WITH</span> <span class="token keyword">GRANT</span> <span class="token keyword">OPTION</span> <span class="token punctuation">]</span>

<span class="token keyword">GRANT</span> { { <span class="token keyword">CREATE</span> <span class="token operator">|</span> <span class="token keyword">CONNECT</span> <span class="token operator">|</span> <span class="token keyword">TEMPORARY</span> <span class="token operator">|</span> <span class="token keyword">TEMP</span> } <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token keyword">ALL</span> <span class="token punctuation">[</span> <span class="token keyword">PRIVILEGES</span> <span class="token punctuation">]</span> }
    <span class="token keyword">ON</span> <span class="token keyword">DATABASE</span> database_name <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
    <span class="token keyword">TO</span> role_specification <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token keyword">WITH</span> <span class="token keyword">GRANT</span> <span class="token keyword">OPTION</span> <span class="token punctuation">]</span>

<span class="token keyword">GRANT</span> { <span class="token keyword">USAGE</span> <span class="token operator">|</span> <span class="token keyword">ALL</span> <span class="token punctuation">[</span> <span class="token keyword">PRIVILEGES</span> <span class="token punctuation">]</span> }
    <span class="token keyword">ON</span> DOMAIN domain_name <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
    <span class="token keyword">TO</span> role_specification <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token keyword">WITH</span> <span class="token keyword">GRANT</span> <span class="token keyword">OPTION</span> <span class="token punctuation">]</span>

<span class="token keyword">GRANT</span> { <span class="token keyword">USAGE</span> <span class="token operator">|</span> <span class="token keyword">ALL</span> <span class="token punctuation">[</span> <span class="token keyword">PRIVILEGES</span> <span class="token punctuation">]</span> }
    <span class="token keyword">ON</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">DATA</span> WRAPPER fdw_name <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
    <span class="token keyword">TO</span> role_specification <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token keyword">WITH</span> <span class="token keyword">GRANT</span> <span class="token keyword">OPTION</span> <span class="token punctuation">]</span>

<span class="token keyword">GRANT</span> { <span class="token keyword">USAGE</span> <span class="token operator">|</span> <span class="token keyword">ALL</span> <span class="token punctuation">[</span> <span class="token keyword">PRIVILEGES</span> <span class="token punctuation">]</span> }
    <span class="token keyword">ON</span> <span class="token keyword">FOREIGN</span> SERVER server_name <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
    <span class="token keyword">TO</span> role_specification <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token keyword">WITH</span> <span class="token keyword">GRANT</span> <span class="token keyword">OPTION</span> <span class="token punctuation">]</span>

<span class="token keyword">GRANT</span> { <span class="token keyword">EXECUTE</span> <span class="token operator">|</span> <span class="token keyword">ALL</span> <span class="token punctuation">[</span> <span class="token keyword">PRIVILEGES</span> <span class="token punctuation">]</span> }
    <span class="token keyword">ON</span> { { <span class="token keyword">FUNCTION</span> <span class="token operator">|</span> <span class="token keyword">PROCEDURE</span> <span class="token operator">|</span> <span class="token keyword">ROUTINE</span> } routine_name <span class="token punctuation">[</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span> <span class="token punctuation">[</span> argmode <span class="token punctuation">]</span> <span class="token punctuation">[</span> arg_name <span class="token punctuation">]</span> arg_type <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
         <span class="token operator">|</span> <span class="token keyword">ALL</span> { FUNCTIONS <span class="token operator">|</span> PROCEDURES <span class="token operator">|</span> ROUTINES } <span class="token operator">IN</span> <span class="token keyword">SCHEMA</span> schema_name <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> }
    <span class="token keyword">TO</span> role_specification <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token keyword">WITH</span> <span class="token keyword">GRANT</span> <span class="token keyword">OPTION</span> <span class="token punctuation">]</span>

<span class="token keyword">GRANT</span> { <span class="token keyword">USAGE</span> <span class="token operator">|</span> <span class="token keyword">ALL</span> <span class="token punctuation">[</span> <span class="token keyword">PRIVILEGES</span> <span class="token punctuation">]</span> }
    <span class="token keyword">ON</span> <span class="token keyword">LANGUAGE</span> lang_name <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
    <span class="token keyword">TO</span> role_specification <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token keyword">WITH</span> <span class="token keyword">GRANT</span> <span class="token keyword">OPTION</span> <span class="token punctuation">]</span>

<span class="token keyword">GRANT</span> { { <span class="token keyword">SELECT</span> <span class="token operator">|</span> <span class="token keyword">UPDATE</span> } <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token keyword">ALL</span> <span class="token punctuation">[</span> <span class="token keyword">PRIVILEGES</span> <span class="token punctuation">]</span> }
    <span class="token keyword">ON</span> LARGE OBJECT loid <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
    <span class="token keyword">TO</span> role_specification <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token keyword">WITH</span> <span class="token keyword">GRANT</span> <span class="token keyword">OPTION</span> <span class="token punctuation">]</span>

<span class="token keyword">GRANT</span> { { <span class="token keyword">CREATE</span> <span class="token operator">|</span> <span class="token keyword">USAGE</span> } <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token keyword">ALL</span> <span class="token punctuation">[</span> <span class="token keyword">PRIVILEGES</span> <span class="token punctuation">]</span> }
    <span class="token keyword">ON</span> <span class="token keyword">SCHEMA</span> schema_name <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
    <span class="token keyword">TO</span> role_specification <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token keyword">WITH</span> <span class="token keyword">GRANT</span> <span class="token keyword">OPTION</span> <span class="token punctuation">]</span>

<span class="token keyword">GRANT</span> { <span class="token keyword">CREATE</span> <span class="token operator">|</span> <span class="token keyword">ALL</span> <span class="token punctuation">[</span> <span class="token keyword">PRIVILEGES</span> <span class="token punctuation">]</span> }
    <span class="token keyword">ON</span> <span class="token keyword">TABLESPACE</span> tablespace_name <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
    <span class="token keyword">TO</span> role_specification <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token keyword">WITH</span> <span class="token keyword">GRANT</span> <span class="token keyword">OPTION</span> <span class="token punctuation">]</span>

<span class="token keyword">GRANT</span> { <span class="token keyword">USAGE</span> <span class="token operator">|</span> <span class="token keyword">ALL</span> <span class="token punctuation">[</span> <span class="token keyword">PRIVILEGES</span> <span class="token punctuation">]</span> }
    <span class="token keyword">ON</span> <span class="token keyword">TYPE</span> type_name <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
    <span class="token keyword">TO</span> role_specification <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token keyword">WITH</span> <span class="token keyword">GRANT</span> <span class="token keyword">OPTION</span> <span class="token punctuation">]</span>

<span class="token keyword">GRANT</span> role_name <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token keyword">TO</span> role_specification <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span> <span class="token keyword">WITH</span> ADMIN <span class="token keyword">OPTION</span> <span class="token punctuation">]</span>
    <span class="token punctuation">[</span> GRANTED <span class="token keyword">BY</span> role_specification <span class="token punctuation">]</span>

<span class="token keyword">where</span> role_specification can be:

    <span class="token punctuation">[</span> <span class="token keyword">GROUP</span> <span class="token punctuation">]</span> role_name
  <span class="token operator">|</span> <span class="token keyword">PUBLIC</span>
  <span class="token operator">|</span> <span class="token keyword">CURRENT_USER</span>
  <span class="token operator">|</span> <span class="token keyword">SESSION_USER</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1);function M(W,V){const a=t("ExternalLinkIcon");return l(),c("div",null,[i,k,u,s("p",null,[n("在postgres13中，用户和角色共用一张表，用户和角色的关系通过"),d,n("区分，能LOGIN的是user，不能LOGIN的是role（目前来看，不保准后面会有特例）。 参考 "),s("a",m,[n("https://www.postgresql.org/docs/15/sql-alterrole.html"),e(a)])]),v,s("p",null,[n("参考官方文档："),s("a",b,[n("https://www.postgresql.org/docs/13/role-attributes.html"),e(a)])]),h,s("p",null,[n("参考："),s("a",w,[n("https://www.postgresql.org/docs/13/sql-alterrole.html"),e(a)]),g,n(" role_specification表示指定role。")]),y,s("p",null,[n("信息参考："),s("a",E,[n("https://www.postgresql.org/docs/13/catalog-pg-database.html"),e(a)])]),f,s("p",null,[n("参考："),s("a",T,[n("https://www.postgresql.org/docs/13/sql-createdatabase.html"),e(a)])]),_,s("p",null,[n("参考 "),s("a",A,[n("https://www.postgresql.org/docs/current/ddl-schemas.html"),e(a)])]),q,s("p",null,[n("参考："),s("a",R,[n("https://www.postgresql.org/docs/13/sql-grant.html"),e(a)])]),O,s("h4",N,[s("a",L,[s("span",null,[s("a",I,[n("Permission denied for schema even though grants were given"),e(a)])])])]),S,s("p",null,[n("参考："),s("a",G,[n("https://www.postgresql.org/docs/13/sql-createtable.html"),e(a)])]),C,s("p",null,[n("参考："),s("a",x,[n("https://www.postgresql.org/docs/13/infoschema-sequences.html"),e(a)])]),P,s("p",null,[n("参考："),s("a",U,[n("https://www.postgresql.org/docs/13/sql-createsequence.html"),e(a)])]),D,s("p",null,[n("参考："),s("a",B,[n("https://www.postgresql.org/docs/13/sql-grant.html"),e(a)])]),H])}const Z=o(r,[["render",M],["__file","Postgresql 命令.html.vue"]]),Q=JSON.parse('{"path":"/posts/notes/Postgresql/Postgresql%20%E5%91%BD%E4%BB%A4.html","title":"pg命令","lang":"en-US","frontmatter":{"icon":"pen-to-square","date":"2021-03-17T00:00:00.000Z","category":["postgresql"],"title":"pg命令","description":"前言 以下命令中[]表示可选项， 角色/用户 在postgres13中，用户和角色共用一张表，用户和角色的关系通过rolcanlogin区分，能LOGIN的是user，不能LOGIN的是role（目前来看，不保准后面会有特例）。 参考 https://www.postgresql.org/docs/15/sql-alterrole.html 查看角色 ...","head":[["meta",{"property":"og:url","content":"https://imarshio.github.io/posts/notes/Postgresql/Postgresql%20%E5%91%BD%E4%BB%A4.html"}],["meta",{"property":"og:site_name","content":"Blog"}],["meta",{"property":"og:title","content":"pg命令"}],["meta",{"property":"og:description","content":"前言 以下命令中[]表示可选项， 角色/用户 在postgres13中，用户和角色共用一张表，用户和角色的关系通过rolcanlogin区分，能LOGIN的是user，不能LOGIN的是role（目前来看，不保准后面会有特例）。 参考 https://www.postgresql.org/docs/15/sql-alterrole.html 查看角色 ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-03-26T15:49:16.000Z"}],["meta",{"property":"article:author","content":"Marshio"}],["meta",{"property":"article:published_time","content":"2021-03-17T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-03-26T15:49:16.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"pg命令\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2021-03-17T00:00:00.000Z\\",\\"dateModified\\":\\"2024-03-26T15:49:16.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Marshio\\",\\"url\\":\\"https://marshio.com\\"}]}"]]},"headers":[{"level":2,"title":"角色/用户","slug":"角色-用户","link":"#角色-用户","children":[{"level":3,"title":"查看角色","slug":"查看角色","link":"#查看角色","children":[]},{"level":3,"title":"创建角色","slug":"创建角色","link":"#创建角色","children":[]},{"level":3,"title":"角色更改","slug":"角色更改","link":"#角色更改","children":[]},{"level":3,"title":"删除角色","slug":"删除角色","link":"#删除角色","children":[]},{"level":3,"title":"查看用户","slug":"查看用户","link":"#查看用户","children":[]},{"level":3,"title":"创建用户","slug":"创建用户","link":"#创建用户","children":[]},{"level":3,"title":"用户切换","slug":"用户切换","link":"#用户切换","children":[]}]},{"level":2,"title":"Database","slug":"database","link":"#database","children":[{"level":3,"title":"查看DB","slug":"查看db","link":"#查看db","children":[]},{"level":3,"title":"创建DB","slug":"创建db","link":"#创建db","children":[]},{"level":3,"title":"切换DB","slug":"切换db","link":"#切换db","children":[]}]},{"level":2,"title":"Schema","slug":"schema","link":"#schema","children":[{"level":3,"title":"创建schema","slug":"创建schema","link":"#创建schema","children":[]},{"level":3,"title":"查看schema","slug":"查看schema","link":"#查看schema","children":[]},{"level":3,"title":"schema权限","slug":"schema权限","link":"#schema权限","children":[]}]},{"level":2,"title":"Table","slug":"table","link":"#table","children":[{"level":3,"title":"查看数据库","slug":"查看数据库","link":"#查看数据库","children":[]},{"level":3,"title":"创建数据库","slug":"创建数据库","link":"#创建数据库","children":[]}]},{"level":2,"title":"Sequence","slug":"sequence","link":"#sequence","children":[{"level":3,"title":"创建Sequence","slug":"创建sequence","link":"#创建sequence","children":[]},{"level":3,"title":"Sequence权限","slug":"sequence权限","link":"#sequence权限","children":[]}]},{"level":2,"title":"Grant","slug":"grant","link":"#grant","children":[]}],"git":{"createdTime":1711468156000,"updatedTime":1711468156000,"contributors":[{"name":"marshio","email":"marshioman@gmail.com","commits":1}]},"readingTime":{"minutes":5.93,"words":1778},"filePathRelative":"posts/notes/Postgresql/Postgresql 命令.md","localizedDate":"March 17, 2021","excerpt":"<p>前言</p>\\n<p>以下命令中<code>[]</code>表示可选项，</p>\\n<h2>角色/用户</h2>\\n<p>在postgres13中，用户和角色共用一张表，用户和角色的关系通过<code>rolcanlogin</code>区分，能LOGIN的是user，不能LOGIN的是role（目前来看，不保准后面会有特例）。\\n参考\\n<a href=\\"https://www.postgresql.org/docs/15/sql-alterrole.html\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://www.postgresql.org/docs/15/sql-alterrole.html</a></p>","autoDesc":true}');export{Z as comp,Q as data};
